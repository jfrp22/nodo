<!-- Añade esto a tu tabla existente -->
<script>
// Función para mostrar diálogo de configuración
function showConfigDialog(nodeMac, currentRole, currentPair) {
  const dialog = document.createElement('div');
  dialog.style.position = 'fixed';
  dialog.style.top = '50%';
  dialog.style.left = '50%';
  dialog.style.transform = 'translate(-50%, -50%)';
  dialog.style.backgroundColor = 'white';
  dialog.style.padding = '20px';
  dialog.style.borderRadius = '8px';
  dialog.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
  dialog.style.zIndex = '1000';
  dialog.style.width = '300px';
  
  // Obtener dispositivos disponibles para emparejar
  const availableMasters = Object.values(devices)
    .filter(d => d.role === 'MASTER' && d.status === 'active')
    .map(d => d.mac);
  
  const availableSlaves = Object.values(devices)
    .filter(d => d.role === 'SLAVE' && d.status === 'active' && !d.paired_with)
    .map(d => d.mac);

  let html = `
    <h3 style="margin-top: 0;">Configurar nodo ${nodeMac}</h3>
    
    <div style="margin-bottom: 15px;">
      <label style="display: block; margin-bottom: 5px;">Rol:</label>
      <select id="roleSelect" style="width: 100%; padding: 8px;" onchange="updatePairingOptions()">
        <option value="UNCONFIGURED" ${currentRole === 'UNCONFIGURED' ? 'selected' : ''}>Sin configurar</option>
        <option value="MASTER" ${currentRole === 'MASTER' ? 'selected' : ''}>Maestro</option>
        <option value="SLAVE" ${currentRole === 'SLAVE' ? 'selected' : ''}>Esclavo</option>
      </select>
    </div>
    
    <div id="pairingContainer" style="margin-bottom: 15px; display: none;">
      <label style="display: block; margin-bottom: 5px;">Emparejar con:</label>
      <select id="pairSelect" style="width: 100%; padding: 8px;">
        <!-- Opciones se llenarán dinámicamente -->
      </select>
    </div>
    
    <div style="display: flex; justify-content: space-between;">
      <button onclick="this.parentElement.remove()" 
              style="padding: 8px 15px; background: #6c757d; color: white; border: none; border-radius: 4px;">
        Cancelar
      </button>
      <button onclick="sendNodeConfig('${nodeMac}')" 
              style="padding: 8px 15px; background: #4361ee; color: white; border: none; border-radius: 4px;">
        Guardar
      </button>
    </div>
    
    <script>
      function updatePairingOptions() {
        const role = document.getElementById('roleSelect').value;
        const pairContainer = document.getElementById('pairingContainer');
        const pairSelect = document.getElementById('pairSelect');
        
        pairSelect.innerHTML = '';
        pairContainer.style.display = 'none';
        
        if (role === 'MASTER') {
          const slaves = ${JSON.stringify(availableSlaves)};
          if (slaves.length > 0) {
            pairContainer.style.display = 'block';
            slaves.forEach(mac => {
              pairSelect.innerHTML += \`<option value="\${mac}">\${mac}</option>\`;
            });
          }
        } 
        else if (role === 'SLAVE') {
          const masters = ${JSON.stringify(availableMasters)};
          if (masters.length > 0) {
            pairContainer.style.display = 'block';
            masters.forEach(mac => {
              pairSelect.innerHTML += \`<option value="\${mac}">\${mac}</option>\`;
            });
          }
        }
      }
      
      // Inicializar opciones
      updatePairingOptions();
      if(${currentRole === 'MASTER' || currentRole === 'SLAVE'}) {
        document.getElementById('pairingContainer').style.display = 'block';
      }
    <\/script>
  `;
  
  dialog.innerHTML = html;
  document.body.appendChild(dialog);
}

// Función para enviar configuración
function sendNodeConfig(nodeMac) {
  const role = document.getElementById('roleSelect').value;
  const pairSelect = document.getElementById('pairSelect');
  const pairWith = pairSelect ? pairSelect.value : '';
  
  const config = {
    target: nodeMac,
    role: role
  };
  
  if (role !== 'UNCONFIGURED' && pairWith) {
    config.pair_with = pairWith;
  }
  
  client.publish('iotlab/nodes/config', JSON.stringify(config));
  alert(`Configuración enviada para ${nodeMac}: ${role} ${pairWith ? 'emparejado con ' + pairWith : ''}`);
  
  // Remover el diálogo
  document.querySelector('div[style*="fixed"]')?.remove();
}

// Modificar la función updateTable para añadir botón de configuración
function updateTable() {
  // ... (código existente)
  
  // En cada fila de nodo, añadir:
  row.innerHTML += `
    <td>
      <button onclick="showConfigDialog('${mac}', '${deviceData.role}', '${deviceData.paired_with || ''}')" 
              class="action-btn">
        <i class="fas fa-cog"></i> Configurar
      </button>
    </td>
  `;
}
</script>
